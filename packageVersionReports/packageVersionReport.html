<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <title>Package Versions</title>
  <style>
/* Add your CSS here */
body {
  font-family: Arial, sans-serif;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th, td {
  padding: 0px;
  text-align: left;
  border-bottom: 1px solid #ddd;
  font-size: 12px;
}

th {
  background-color: #4CAF50;
  color: white;
}

th-black {
  background-color: #4CAF50;
  color: black;
}

tr:hover {background-color: #f5f5f5;}

.dt-button {
  font-size: 18px;
  padding: 5px 10px;
}

.diff {
  background-color: #ffc107;
  color: #000;
}

  /* Inject the DataTables CSS */
</style>
</head>
<body>
  <h1>Package Versions</h1>

  <table id="packageTable">
    <thead>
    <tr>
      <th>PackageName</th>
      <th>Type</th>
      
        <th>qa</th>
      
        <th>masterdev</th>
      
        <th>sit</th>
      
        <th>staging</th>
      
        <th>prod</th>
      
    </tr>
    </thead>
    <tbody>
      
        <tr>
          <td>Checkout Management App</td>
          <td>Managed</td>
          
            <td>1.14.0.3</td>
          
            <td>N/A</td>
          
            <td>1.14.0.3</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>DevOps Center</td>
          <td>Managed</td>
          
            <td>5.7.0.5</td>
          
            <td>N/A</td>
          
            <td>5.7.0.5</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>License Management App</td>
          <td>Managed</td>
          
            <td>1.21.0.1</td>
          
            <td>N/A</td>
          
            <td>1.21.0.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>Org Expiry Notifier</td>
          <td>Managed</td>
          
            <td>1.0.0.1</td>
          
            <td>N/A</td>
          
            <td>1.0.0.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>PBO Guide</td>
          <td>Managed</td>
          
            <td>1.4.0.1</td>
          
            <td>N/A</td>
          
            <td>1.4.0.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>SFDC Channel Order</td>
          <td>Managed</td>
          
            <td>3.65.0.2</td>
          
            <td>N/A</td>
          
            <td>3.65.0.2</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>feature-management</td>
          <td>OrgDependendent</td>
          
            <td>1.0.8.1</td>
          
            <td>N/A</td>
          
            <td>1.0.8.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>pmcPartner</td>
          <td>Managed</td>
          
            <td>1.68.0.1</td>
          
            <td>N/A</td>
          
            <td>1.68.0.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>sfpowerscripts-artifact</td>
          <td>Unlocked</td>
          
            <td>2.0.0.1</td>
          
            <td>N/A</td>
          
            <td>2.0.0.1</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
        <tr>
          <td>unpackaged</td>
          <td>Source/Data</td>
          
            <td>1.0.5.6001333856</td>
          
            <td>N/A</td>
          
            <td>1.0.6.6032293218</td>
          
            <td>N/A</td>
          
            <td>N/A</td>
          
        </tr>
      
      </tbody>
    </table>

        <div class="modal" tabindex="-1" role="dialog" id="packageModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Package Details</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" id="closeModal">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <table id="packageDetailsTable" class="table-bordered">
                  <thead>
                    <tr>
                      <th>Environment</th>
                      <th>Version</th>
                      <th class="th-black">Subscriber Version</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
         </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    window.sortedPackages = {"Checkout Management App":{"qa":{"version":"1.14.0.3","type":"Managed","subscriberVersion":"04t1Q000000kYiVQAU"},"sit":{"version":"1.14.0.3","type":"Managed","subscriberVersion":"04t1Q000000kYiVQAU"}},"DevOps Center":{"qa":{"version":"5.7.0.5","type":"Managed","subscriberVersion":"04t6g000008b3LcAAI"},"sit":{"version":"5.7.0.5","type":"Managed","subscriberVersion":"04t6g000008b3LcAAI"}},"License Management App":{"qa":{"version":"1.21.0.1","type":"Managed","subscriberVersion":"04t30000001DX1FAAW"},"sit":{"version":"1.21.0.1","type":"Managed","subscriberVersion":"04t30000001DX1FAAW"}},"Org Expiry Notifier":{"qa":{"version":"1.0.0.1","type":"Managed","subscriberVersion":"04t1n0000028OJ6AAM"},"sit":{"version":"1.0.0.1","type":"Managed","subscriberVersion":"04t1n0000028OJ6AAM"}},"PBO Guide":{"qa":{"version":"1.4.0.1","type":"Managed","subscriberVersion":"04t5w000003Vj4iAAC"},"sit":{"version":"1.4.0.1","type":"Managed","subscriberVersion":"04t5w000003Vj4iAAC"}},"SFDC Channel Order":{"qa":{"version":"3.65.0.2","type":"Managed","subscriberVersion":"04t2K000000AgwXQAS"},"sit":{"version":"3.65.0.2","type":"Managed","subscriberVersion":"04t2K000000AgwXQAS"}},"feature-management":{"qa":{"version":"1.0.8.1","type":"OrgDependendent","subscriberVersion":"04t2w000009RdmEAAS"},"sit":{"version":"1.0.8.1","type":"OrgDependendent","subscriberVersion":"04t2w000009RdmEAAS"}},"pmcPartner":{"qa":{"version":"1.68.0.1","type":"Managed","subscriberVersion":"04t4x000000eOrWAAU"},"sit":{"version":"1.68.0.1","type":"Managed","subscriberVersion":"04t4x000000eOrWAAU"}},"sfpowerscripts-artifact":{"qa":{"version":"2.0.0.1","type":"Unlocked","subscriberVersion":"04t1P000000ka9mQAA"},"sit":{"version":"2.0.0.1","type":"Unlocked","subscriberVersion":"04t1P000000ka9mQAA"}},"unpackaged":{"qa":{"version":"1.0.5.6001333856","type":"Source/Data","subscriberVersion":"N/A"},"sit":{"version":"1.0.6.6032293218","type":"Source/Data","subscriberVersion":"N/A"}}};
    window.environments = ["qa","masterdev","sit","staging","prod"];
  </script>
  <script>
      /* Inject the DataTables JavaScript */
      /* Inject the Buttons JavaScript */
      /* Inject the Buttons ColVis JavaScript */
      /* Inject the JSZip JavaScript */
      /* Inject the PDFMake JavaScript */
      /* Inject the vfs_fonts JavaScript */

    $(document).ready(function() {
      $('#packageTable').DataTable({
        dom: 'Bfrtip',
        paginate: false,
        drawCallback: function (settings) {
          var api = this.api();
          api.rows().every(function () {
            var d = this.data();
            var baseValue = null;
            for (var i = d.length - 1; i >= 3; i--) { // Start from the last environment column
              if (d[i] !== 'N/A') {
                baseValue = d[i];
                break;
              }
            }
            if (baseValue !== null) {
              var diffFlag = false;
              for (var i = 3; i < d.length; i++) { 
                if (d[i] !== 'N/A' && d[i] !== baseValue) {
                  // The cell value is different from the baseline
                  // Add the 'diff' class to the cell
                  $(this.node()).find('td:eq(' + i + ')').addClass('diff');  // using string concatenation
                  diffFlag = true;
                }
              }
              // If any differences were found, highlight the package name cell
              if (diffFlag) {
                $(this.node()).find('td:eq(0)').addClass('diff');
              }
            }
            
          });
        }
      });     
      
      
      $('#packageTable').on('click', 'tbody tr', function() {
        const rowData = $('#packageTable').DataTable().row(this).data();
        const packageName = rowData[0];
        const packageData = sortedPackages[packageName];
      
        const detailsTableBody = $("#packageDetailsTable tbody");
        detailsTableBody.empty();
      
        environments.forEach((env) => {
          const data = packageData[env];
          if (data) {
            detailsTableBody.append('<tr><td>' + env + '</td><td>' + data.version + '</td><td>' + data.subscriberVersion + '</td></tr>');
          } else {
            detailsTableBody.append('<tr><td>' + env + '</td><td>N/A</td><td>N/A</td></tr>');
          }
        });
      
        var packageModal = new bootstrap.Modal(document.getElementById('packageModal'));
        packageModal.show();
      });


      document.getElementById('closeModal').addEventListener('click', function() {
        var packageModal = new bootstrap.Modal(document.getElementById('packageModal'));
        packageModal.hide();
      });

    });

 
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
</body>
</html>